!-----------------------------------------------------------------------------------------------!
SUBROUTINE ANGRI(NX,NY,IDIST)
!-----------------------------------------------------------------------------------------------!
IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!-----------------------------------------------------------------------------------------------!
PARAMETER(NDIM=150)
!-----------------------------------------------------------------------------------------------!
COMMON /COOR/  X(0:NDIM+1,0:NDIM+1),Y(0:NDIM+1,0:NDIM+1)
COMMON /AREA/  DSI(NDIM,4),DST(4),IDSIT(4),IAK(2),JAK(2)
COMMON /TRANS/ FXI(NDIM,NDIM),FETA(NDIM,NDIM)
!-----------------------------------------------------------------------------------------------!
UM=1.D0
PI=4.D0*DATAN(UM)
CRG=180.D0/PI
ZERO=1.D-11
!-----------------------------------------------------------------------------------------------!
A12T=0.D0
A12M=0.D0
J12M=0
I12M=0
!-----------------------------------------------------------------------------------------------!
NXM1=NX-1
NYM1=NY-1
!-----------------------------------------------------------------------------------------------!
DO I=2,NXM1
   IM1=I-1
   IP1=I+1
!-----------------------------------------------------------------------------------------------!
   DO J=2,NYM1
      JM1=J-1
      JP1=J+1
!-----------------------------------------------------------------------------------------------!
      DXDKS=X(J,IP1)-X(J,IM1)
      DYDKS=Y(J,IP1)-Y(J,IM1)
!-----------------------------------------------------------------------------------------------!
      DXDET=X(JP1,I)-X(JM1,I)
      DYDET=Y(JP1,I)-Y(JM1,I)
!-----------------------------------------------------------------------------------------------!
      G12=DXDKS*DXDET+DYDKS*DYDET
!-----------------------------------------------------------------------------------------------!
      RG11=DSQRT(DXDKS**2+DYDKS**2)
      RG22=DSQRT(DXDET**2+DYDET**2)
      RG11=MAX(RG11,ZERO)
      RG22=MAX(RG22,ZERO)
!-----------------------------------------------------------------------------------------------!
      G12=G12/(RG11*RG22)
      G12=DACOS(G12)*CRG
      G12=DABS(90.D0-G12)
!-----------------------------------------------------------------------------------------------!
      A12T=A12T+G12
      IF (G12 > A12M) THEN
         A12M=G12
         J12M=J
         I12M=I
      END IF !(G12 > A12M)
!-----------------------------------------------------------------------------------------------!
      SG=DXDKS*DYDET-DXDET*DYDKS
!-----------------------------------------------------------------------------------------------!
!!    IF(SG <= 0.D0) WRITE(6,2000) J,I,DXDKS,DYDKS,DXDET,DYDET,SG
!-----------------------------------------------------------------------------------------------!
   END DO !J=2,NYM1
END DO !I=2,NXM1
!-----------------------------------------------------------------------------------------------!
A12T=A12T/FLOAT(NXM1)/FLOAT(NYM1)
!-----------------------------------------------------------------------------------------------!
!!WRITE(6,1000) A12T,A12M,J12M,I12M
IF(IDIST == 0) RETURN
!-----------------------------------------------------------------------------------------------!
NXM1=NX-1
NYM1=NY-1
!-----------------------------------------------------------------------------------------------!
DSM1=0.D0
DSM3=0.D0
DO I=2,NXM1
   DSL1=DSQRT((X( 2,I)-X(   1,I))**2+(Y( 2,I)-Y(   1,I))**2)
   IF (DSI(I,1) >= 1.D-10) DSL1=DSL1/DSI(I,1)
   DSL3=DSQRT((X(NY,I)-X(NYM1,I))**2+(Y(NY,I)-Y(NYM1,I))**2)
   IF (DSI(I,3) >= 1.D-10) DSL3=DSL3/DSI(I,3)
   DSM1=MAX(DSM1,DSL1)
   DSM3=MAX(DSM3,DSL3)
   DSI1=MIN(DSI1,DSL1)
   DSI3=MIN(DSI3,DSL3)
END DO !I=2,NXM1
!-----------------------------------------------------------------------------------------------!
DSM2=0.D0
DSM4=0.D0
DSI2=1000.D0
DSI4=1000.D0
DO J=2,NYM1
   DSL2=DSQRT((X(J, 2)-X(J,   1))**2+(Y(J, 2)-Y(J,   1))**2)
   IF (DSI(J,2) >= 1.D-10) DSL2=DSL2/DSI(J,2)
   DSL4=DSQRT((X(J,NX)-X(J,NXM1))**2+(Y(J,NX)-Y(J,NXM1))**2)
   IF (DSI(J,4) >= 1.D-10) DSL4=DSL4/DSI(J,4)
   DSM2=MAX(DSM2,DSL2)
   DSM4=MAX(DSM4,DSL4)
   DSI2=MIN(DSI2,DSL2)
   DSI4=MIN(DSI4,DSL4)
END DO !J=2,NYM1
!!WRITE(6,1100) DSM1,DSM2,DSM3,DSM4
!-----------------------------------------------------------------------------------------------!
1000 FORMAT(//,'      MEAN DEVIATION ',F8.3,/, &
               '   MAXIMUM DEVIATION ',F8.3,' AT NODE (',I3,',',I3,')')
1100 FORMAT(/,'  DISTANCES TO THE BOUNDARY ',//, &
              '    SIDE ETA=0, RDS = ',F10.3,/, &
              '    SIDE XI =0, RDS = ',F10.3,/, &
              '    SIDE ETA=1, RDS = ',F10.3,/, &
              '    SIDE XI =1, RDS = ',F10.3)
2000 FORMAT(2I5,5(1X,1PE10.2))
!-----------------------------------------------------------------------------------------------!
RETURN
!-----------------------------------------------------------------------------------------------!
END SUBROUTINE ANGRI
!-----------------------------------------------------------------------------------------------!
